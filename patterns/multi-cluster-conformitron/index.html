
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../pipeline-multi-env-gitops/">
      
      
        <link rel="next" href="../nginx/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>Multi cluster conformitron pattern - Amazon EKS Blueprints Patterns</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a40c8224.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#multi-cluster-pattern-with-observability-cost-optimizations-and-metrics-aggregation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Amazon EKS Blueprints Patterns" class="md-header__button md-logo" aria-label="Amazon EKS Blueprints Patterns" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Amazon EKS Blueprints Patterns
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Multi cluster conformitron pattern
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/aws-samples/cdk-eks-blueprints-patterns" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    aws-samples/cdk-eks-blueprints-patterns
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Amazon EKS Blueprints Patterns" class="md-nav__button md-logo" aria-label="Amazon EKS Blueprints Patterns" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Amazon EKS Blueprints Patterns
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aws-samples/cdk-eks-blueprints-patterns" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    aws-samples/cdk-eks-blueprints-patterns
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Patterns
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Generative AI
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Generative AI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../generative-ai/showcase/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prompt Showcase Pattern
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Observability Patterns
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Observability Patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_2_1" id="__nav_2_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    New Cluster
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_1">
            <span class="md-nav__icon md-icon"></span>
            New Cluster
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../observability/single-new-eks-native/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Native Observability Pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../observability/single-new-eks-graviton-opensource-observability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Graviton Observability Pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../observability/single-new-eks-opensource/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OSS Observability Pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../observability/single-new-eks-awsnative-fargate-observability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fargate Observability Pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../observability/single-new-eks-mixed-observability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mixed Observability Pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../observability/multi-acc-new-eks-mixed-observability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multi-Cluster Multi-Region Monitoring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../observability/single-new-eks-apiserver-opensource-observability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OSS Apiserver Monitoring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../observability/single-new-eks-gpu-opensource-observability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OSS GPU Monitoring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../observability/single-new-eks-java-opensource-observability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OSS Java Monitoring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../observability/single-new-eks-nginx-opensource-observability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OSS Nginx Monitoring
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Existing Cluster
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            Existing Cluster
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../observability/existing-eks-awsnative-observability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Native Observability Pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../observability/existing-eks-mixed-observability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mixed Observability Pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../observability/existing-eks-opensource-observability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OSS Observability Pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../observability/existing-eks-apiserver-observability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OSS Apiserver Monitoring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../observability/existing-eks-nginx-observability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OSS Nginx Monitoring
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../observability/multi-account-monitoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multi Account Observability Pattern
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Security Patterns
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Security Patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/eks-config-rules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EKS Config Rules
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/encryption-at-rest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Encryption At Rest
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/guardduty/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GuardDuty
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/image-scanning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Image Scanning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/securityhub/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SecurityHub
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Batch Pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../backstage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Backstage Pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../custom-networking-with-ipv4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customer Network with IPV4 Pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../instana/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Instana Pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jupyterhub/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Jupyterhub Pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../knoveyor.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Konveyor Pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kubeflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubeflow Pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kubeshark/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubeshark Pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pipeline-multi-env-gitops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multi environment Pipeline GitOps pattern Pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Multi cluster conformitron pattern
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Multi cluster conformitron pattern
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objective" class="md-nav__link">
    <span class="md-ellipsis">
      Objective
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Objective">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gitops-confguration" class="md-nav__link">
    <span class="md-ellipsis">
      GitOps confguration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploying" class="md-nav__link">
    <span class="md-ellipsis">
      Deploying
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grafana-dashboards" class="md-nav__link">
    <span class="md-ellipsis">
      Grafana Dashboards
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nginx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nginx Pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../secureingresscognito/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Secure Ingress and Authentication Pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graviton/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Graviton Pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../windows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows Pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gmaestro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    gMaestro Pattern
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objective" class="md-nav__link">
    <span class="md-ellipsis">
      Objective
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Objective">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gitops-confguration" class="md-nav__link">
    <span class="md-ellipsis">
      GitOps confguration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploying" class="md-nav__link">
    <span class="md-ellipsis">
      Deploying
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grafana-dashboards" class="md-nav__link">
    <span class="md-ellipsis">
      Grafana Dashboards
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="multi-cluster-pattern-with-observability-cost-optimizations-and-metrics-aggregation">Multi-cluster pattern with observability, cost optimizations and metrics aggregation<a class="headerlink" href="#multi-cluster-pattern-with-observability-cost-optimizations-and-metrics-aggregation" title="Permanent link">¤</a></h1>
<h2 id="objective">Objective<a class="headerlink" href="#objective" title="Permanent link">¤</a></h2>
<p>This pattern was started to solve a problem faced at AWS. We often get third-party software for validation and need a consistent automated approach to run Kubernetes evaluator testing, deployment of containerized products, and validation in Kubernetes environments on a variety of Amazon EKS environments. </p>
<p>In this pattern we:</p>
<ol>
<li>
<p>Automate deployment of multiple EKS cluster in a region, with a Continuous Deployment pipeline triggered upon a commit to the GitHub repository that hosts the pipeline configuration.</p>
</li>
<li>
<p>Configure the EKS clusters to deploy with different architectures (x86 or ARM or Bottlerocket) and different Kubernetes versions (3 most recent by default).</p>
</li>
<li>
<p>Automate testing of all the available <a href="https://github.com/aws-samples/eks-anywhere-addons">EKS Anywhere Addons</a>, on each of the clusters, essentially testing their compatibility across all the potential architecture/version available today on AWS. </p>
</li>
<li>
<p>Deploying this pattern 24x7 we observed high costs (300$ a day). By using the AWS Systems Manager Automations and AutoScaling Groups we scale-down to zero during non-business hours resulting in 60% cost savings. We also borrowed optimized OTEL collector configurations from  <a href="https://github.com/aws-observability/cdk-aws-observability-accelerator">CDK Observability Accelerator</a> to further reduce Prometheus storage costs. </p>
</li>
</ol>
<p>To learn more about our EKS Addon validation checkout our <a href="https://aws.amazon.com/blogs/containers/conformitron-validate-third-party-software-with-amazon-eks-and-amazon-eks-anywhere/">blog</a></p>
<p><img alt="Architecture of multi-cluster deployment" src="../images/conformitron.png" /></p>
<h3 id="gitops-confguration">GitOps confguration<a class="headerlink" href="#gitops-confguration" title="Permanent link">¤</a></h3>
<p>GitOps is a branch of DevOps that focuses on using Git code repositories to manage infrastructure and application code deployments.</p>
<p>For this pattern there is a git driven deployment using GitHub and Codepipeline which automatically redploys the EKS Clusters when modifications are made to the GitHub repo. </p>
<p>Secondly, for the deployment of workloads on the cluster we leverage FluxCD, this a GitOps approach for the workloads i.e. the third-party-software we want to validate on our hardware.</p>
<p>We require some additional secrets to be created in Secrets Manager for the pattern to function properly</p>
<ol>
<li>AWS CodePipeline Bootstrap - The AWS CodePipeline points to the GitHub fork of this repository i.e [cdk-eks-blueprint-patterns] (<a href="https://github.com/aws-samples/cdk-eks-blueprints-patterns">https://github.com/aws-samples/cdk-eks-blueprints-patterns</a>). </li>
</ol>
<p>A <code>github-token</code> secret must be stored as plaintext in AWS Secrets Manager for the CodePipeline to access the webhooks on GitHub. For more information on how/why to set it up, please refer to the <a href="https://docs.aws.amazon.com/codepipeline/latest/userguide/GitHub-create-personal-token-CLI.html">docs</a>. The GitHub Personal Access Token should have these scopes:
   1. <em>repo</em> - to read your forked cdk-blueprint-patterns repostiory
   1. <em>admin:repo_hook</em> - if you plan to use webhooks (enabled by default)</p>
<ol>
<li>FluxCD Bootstrap - The FluxCD points to the <a href="https://github.com/aws-samples/eks-anywhere-addons">EKS Anywhere Addons</a> repository. Since this is a public repository you will not need to add a github token to read it.</li>
</ol>
<p>As part of the FluxCD configuration, it uses Kustomize to apply all the addons that are in the repository along with deploying their functional tests and a custom validator cronJob.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">¤</a></h2>
<p>Start by setting the account and region environment variables:</p>
<p><div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">ACCOUNT_ID</span><span class="o">=</span><span class="k">$(</span>aws<span class="w"> </span>sts<span class="w"> </span>get-caller-identity<span class="w"> </span>--query<span class="w"> </span><span class="s1">&#39;Account&#39;</span><span class="w"> </span>--output<span class="w"> </span>text<span class="k">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">AWS_REGION</span><span class="o">=</span><span class="k">$(</span>aws<span class="w"> </span>configure<span class="w"> </span>get<span class="w"> </span>region<span class="k">)</span>
</code></pre></div>
1. In case you haven't done this before, bootstrap your AWS Account for AWS CDK use using:</p>
<div class="highlight"><pre><span></span><code>```bash
cdk bootstrap
```
</code></pre></div>
<ol>
<li>Fork this repository (cdk-eks-blueprints-patterns) to your GitHub organisation/user</li>
<li>Git clone your forked repository onto your machine</li>
<li>
<p>Install the AWS CDK Toolkit globally on your machine using</p>
<div class="highlight"><pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>aws-cdk@2.133.0
</code></pre></div>
</li>
<li>
<p>Increase AWS service quota for required resources, navigate to <a href="https://aws.amazon.com/getting-started/hands-on/request-service-quota-increase/">Service Quota Tutorial</a> to learn more
<div class="highlight"><pre><span></span><code>   SERVICE                                   | QUOTA NAME                         | REQUESTED QUOTA
   Amazon Virtual Private Cloud (Amazon VPC) | NAT gateways per Availability Zone | 30 
   Amazon Virtual Private Cloud (Amazon VPC) | VPCs per region                    | 30
   Amazon Elastic Compute Cloud (Amazon EC2) | EC2-VPC Elastic IPs                | 30
</code></pre></div>
We are using seperate VPC as a best practice, but you can use default vpc if you prefer. Also, If you decide to use different regions for each cluster you dont need quota increase, please reach out if you have need for this use case.</p>
</li>
<li>
<p>Amazon Managed Grafana Workspace: To visualize metrics collected, you need an Amazon Managed Grafana workspace. If you have an existing workspace, create environment variables <code>AMG_ENDPOINT_URL</code> as described below. </p>
</li>
</ol>
<p>Else, to create a new workspace, visit and run our <a href="https://aws-observability.github.io/terraform-aws-observability-accelerator/helpers/managed-grafana/">supporting example for Grafana Deployment</a></p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">AMG_ENDPOINT_URL</span><span class="o">=</span>https://g-xxx.grafana-workspace.region.amazonaws.com
<span class="nb">export</span><span class="w"> </span><span class="nv">AMG_WORKSPACE_ID</span><span class="o">=</span>g-xxx
</code></pre></div>
<ol>
<li>
<p>Grafana API Key: Amazon Managed Grafana provides a control plane API for generating Grafana API keys or Service Account Tokens. This allows programatic provisioning of Grafana dashboards using the EKS grafana operator.</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">AMG_API_KEY</span><span class="o">=</span><span class="k">$(</span>aws<span class="w"> </span>grafana<span class="w"> </span>create-workspace-api-key<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--key-name<span class="w"> </span><span class="s2">&quot;grafana-operator-key&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--key-role<span class="w"> </span><span class="s2">&quot;ADMIN&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--seconds-to-live<span class="w"> </span><span class="m">432000</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--workspace-id<span class="w"> </span><span class="nv">$AMG_WORKSPACE_ID</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--query<span class="w"> </span>key<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--output<span class="w"> </span>text<span class="k">)</span>
</code></pre></div>
</li>
<li>
<p>AWS SSM Parameter Store for GRAFANA API KEY: Update the Grafana API key secret in AWS SSM Parameter Store using the above new Grafana API key. This will be referenced by Grafana Operator deployment of our solution to access and provision Grafana dashboards from Amazon EKS monitoring Cluster</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code>aws<span class="w"> </span>ssm<span class="w"> </span>put-parameter<span class="w"> </span>--name<span class="w"> </span><span class="s2">&quot;/grafana-api-key&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--type<span class="w"> </span><span class="s2">&quot;SecureString&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--value<span class="w"> </span><span class="nv">$AMG_API_KEY</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--region<span class="w"> </span><span class="nv">$AWS_REGION</span>
</code></pre></div>
<ol>
<li>Amazon Managed Prometheus Workspace: To store observability metrics from all clusters we will use Amazon Managed Prometheus due to it's ease of setup and easy integration with other AWS services. We recommend setting up a new seperate Prometheus workspace using the CLI commands below. The provisioning of a new AMP workspace can be automated by leveraging the <code>.resourceProvider</code> in our CDK blueprints. See <a href="https://github.com/aws-observability/cdk-aws-observability-accelerator/blob/main/lib/existing-eks-opensource-observability-pattern/index.ts">Example</a>. We intentionally left this out to allow to connecting with existing AMP deployments, but please reach out to us if you need guidance on automate this provisioning.</li>
</ol>
<div class="highlight"><pre><span></span><code>aws<span class="w"> </span>amp<span class="w"> </span>create-workspace<span class="w"> </span>--alias<span class="w"> </span>conformitron
</code></pre></div>
<p>Copy the <code>workspaceID</code> from the output and export it as a variable</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">AMP_WS_ID</span><span class="o">=</span>ws-xxxxxxx-xxxx-xxxx-xxxx-xxxxxx
</code></pre></div>
<ol>
<li>Modify the code in your forked repo to point to your GitHub username/organisation. Open the <a href="../../lib/multi-cluster-construct/pipeline.ts">pattern file source code</a> and look for the declared const of <code>gitOwner</code>. Change it to your GitHub username.</li>
</ol>
<h2 id="deploying">Deploying<a class="headerlink" href="#deploying" title="Permanent link">¤</a></h2>
<p>Clone the repository:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/aws-samples/cdk-eks-blueprints-patterns.git
<span class="nb">cd</span><span class="w"> </span>cdk-eks-blueprints-patterns
</code></pre></div>
<p>Set the pattern's parameters in the CDK context by overriding the <em>cdk.json</em> file (edit <em>PARENT_DOMAIN_NAME</em> as it fits):
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span><span class="s">&lt;&lt; EOF &gt; cdk.json</span>
<span class="s">{</span>
<span class="s">    &quot;app&quot;: &quot;npx ts-node dist/lib/common/default-main.js&quot;,</span>
<span class="s">    &quot;context&quot;: {</span>
<span class="s">        &quot;conformitron.amp.endpoint&quot;: &quot;https://aps-workspaces.${AWS_REGION}.amazonaws.com/workspaces/${AMP_WS_ID}/&quot;,</span>
<span class="s">        &quot;conformitron.amp.arn&quot;:&quot;arn:aws:aps:${AWS_REGION}:${ACCOUNT_ID}:workspace/${AMP_WS_ID}&quot;,</span>
<span class="s">        &quot;conformitron.amg.endpoint&quot;: &quot;${AMG_ENDPOINT_URL}&quot;,</span>
<span class="s">        &quot;conformitron.version&quot;: [&quot;1.28&quot;,&quot;1.29&quot;,&quot;1.30&quot;],</span>
<span class="s">        &quot;fluxRepository&quot;: {</span>
<span class="s">        &quot;name&quot;: &quot;grafana-dashboards&quot;,</span>
<span class="s">        &quot;namespace&quot;: &quot;grafana-operator&quot;,</span>
<span class="s">        &quot;repository&quot;: {</span>
<span class="s">          &quot;repoUrl&quot;: &quot;https://github.com/aws-observability/aws-observability-accelerator&quot;,</span>
<span class="s">          &quot;name&quot;: &quot;grafana-dashboards&quot;,</span>
<span class="s">          &quot;targetRevision&quot;: &quot;main&quot;,</span>
<span class="s">          &quot;path&quot;: &quot;./artifacts/grafana-operator-manifests/eks/infrastructure&quot;</span>
<span class="s">        },</span>
<span class="s">        &quot;values&quot;: {</span>
<span class="s">          &quot;GRAFANA_CLUSTER_DASH_URL&quot; : &quot;https://raw.githubusercontent.com/aws-observability/aws-observability-accelerator/main/artifacts/grafana-dashboards/eks/infrastructure/cluster.json&quot;,</span>
<span class="s">          &quot;GRAFANA_KUBELET_DASH_URL&quot; : &quot;https://raw.githubusercontent.com/aws-observability/aws-observability-accelerator/main/artifacts/grafana-dashboards/eks/infrastructure/kubelet.json&quot;,</span>
<span class="s">          &quot;GRAFANA_NSWRKLDS_DASH_URL&quot; : &quot;https://raw.githubusercontent.com/aws-observability/aws-observability-accelerator/main/artifacts/grafana-dashboards/eks/infrastructure/namespace-workloads.json&quot;,</span>
<span class="s">          &quot;GRAFANA_NODEEXP_DASH_URL&quot; : &quot;https://raw.githubusercontent.com/aws-observability/aws-observability-accelerator/main/artifacts/grafana-dashboards/eks/infrastructure/nodeexporter-nodes.json&quot;,</span>
<span class="s">          &quot;GRAFANA_NODES_DASH_URL&quot; : &quot;https://raw.githubusercontent.com/aws-observability/aws-observability-accelerator/main/artifacts/grafana-dashboards/eks/infrastructure/nodes.json&quot;,</span>
<span class="s">          &quot;GRAFANA_WORKLOADS_DASH_URL&quot; : &quot;https://raw.githubusercontent.com/aws-observability/aws-observability-accelerator/main/artifacts/grafana-dashboards/eks/infrastructure/workloads.json&quot;</span>
<span class="s">        },</span>
<span class="s">        &quot;kustomizations&quot;: [</span>
<span class="s">          {</span>
<span class="s">            &quot;kustomizationPath&quot;: &quot;./artifacts/grafana-operator-manifests/eks/infrastructure&quot;</span>
<span class="s">          }</span>
<span class="s">        ]</span>
<span class="s">    }</span>
<span class="s">  }</span>
<span class="s">}</span>

<span class="s">EOF</span>
</code></pre></div></p>
<p>You are now ready to deploy the pipeline. Run the following command from the root of this repository to deploy the pipeline stack:</p>
<div class="highlight"><pre><span></span><code>make<span class="w"> </span>pattern<span class="w"> </span>multi-cluster-conformitron<span class="w"> </span>deploy<span class="w"> </span>multi-cluster-central-pipeline
</code></pre></div>
<p>Now you can go to <a href="https://eu-west-1.console.aws.amazon.com/codesuite/codepipeline/pipelines">AWS CodePipeline console</a>, and see how it was automatically created to deploy multiple Amazon EKS clusters to different environments.</p>
<h2 id="grafana-dashboards">Grafana Dashboards<a class="headerlink" href="#grafana-dashboards" title="Permanent link">¤</a></h2>
<p><img alt="Dashboard 1" src="../images/ConformitronDashboard1.png" /></p>
<p><img alt="Dashboard 2" src="../images/ConformitronDashboard2.png" /></p>
<p><img alt="Dashboard 3" src="../images/ConformitronDashboard3.png" /></p>
<h1 id="ssm-cost-optimizations-for-conformitron-clusters">SSM Cost Optimizations for conformitron clusters<a class="headerlink" href="#ssm-cost-optimizations-for-conformitron-clusters" title="Permanent link">¤</a></h1>
<p>Running all the clusters by default for 24 hours results in a daily spend of $300+</p>
<p>To minimize these costs we have written a systems manager automation which automatically scales down autoscaling group to 0 desired nodes during off-business hours.</p>
<p>On weekdays 5 PM PST clusters are scaled to 0 -&gt; CRON EXPRESSION:  <code>0 17 ? * MON-FRI *</code>
On weekdays 5 AM PST clusters are scaled to 1 -&gt; CRON EXPRESSION:  <code>0 05 ? * MON-FRI *</code>
On weekends clusters stay scaled to 0.</p>
<p>These optimizations bring down the weekly cost to less than 1000$ essentially for a more than 60% cost savings.</p>
<p>Please find the SSM Automation documents <code>lib/multi-cluster-construct/resources/cost-optimization/scaleDownEksToZero.yml</code> and <code>lib/multi-cluster-construct/resources/cost-optimization/scaleUpEksToOne.yml</code>. </p>
<p>Lets take a look at one of the scripts <code>scaleDownEksToZero.yml</code></p>
<p><div class="highlight"><pre><span></span><code><span class="nt">schemaVersion</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.3&#39;</span>
<span class="nn">...</span>
<span class="nn">...</span>
<span class="nt">mainSteps</span><span class="p">:</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">inputs</span><span class="p p-Indicator">:</span>
<span class="w">      </span><span class="nt">Service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eks</span>
<span class="w">      </span><span class="nt">Api</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UpdateNodegroupConfig      &lt;---- Update the managed node group</span><span class="w"> </span>
<span class="w">      </span><span class="nt">clusterName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arm-1-26-blueprint &lt;---- Modify according to your naming convention</span>
<span class="w">      </span><span class="nt">nodegroupName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eks-blueprints-mng</span>
<span class="w">      </span><span class="nt">scalingConfig</span><span class="p">:</span>
<span class="w">        </span><span class="nt">minSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0                    &lt;---- New Scaling Configuration</span>
<span class="w">        </span><span class="nt">maxSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">        </span><span class="nt">desiredSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0                &lt;---- Scale To zero</span>
</code></pre></div>
By triggering this automation at 5PM on Weekdays we automatically scale down clusters during off-hours.</p>
<p>To run these scripts first you will have to modify update them with your own account_ID
We will use <code>sed</code> command to automatically update the files
<div class="highlight"><pre><span></span><code>sed<span class="w"> </span><span class="s2">&quot;s/ACCOUNT_ID/</span><span class="nv">$ACCOUNT_ID</span><span class="s2">/g&quot;</span><span class="w"> </span>scaleDownEksToZero.yml<span class="w"> </span>&gt;<span class="w"> </span>scaleDownEksToZeroNew.yml
sed<span class="w"> </span><span class="s2">&quot;s/ACCOUNT_ID/</span><span class="nv">$ACCOUNT_ID</span><span class="s2">/g&quot;</span><span class="w"> </span>scaleUpEksToOne.yml<span class="w"> </span>&gt;<span class="w"> </span>scaleUpEksToOneNew.yml
</code></pre></div></p>
<ol>
<li>Then navigate to the Systems Manager &gt; Documents and Create a new Automation.</li>
</ol>
<p><img alt="Cost Optimization Step 1" src="../images/CostOptimizationSSM1.png" /></p>
<ol>
<li>Click on JSON and copy over the yml content to create a new runbook</li>
</ol>
<p><img alt="Cost Optimization Step 2" src="../images/CostOptimizationSSM2.png" /></p>
<ol>
<li>Once saved, navigate to EventBridge &gt; Scheduler &gt; Schedules</li>
</ol>
<p><img alt="Cost Optimization Step 3" src="../images/CostOptimizationEventBridge.png" /></p>
<ol>
<li>Create a new schedule with the CRON expression specified aboce</li>
</ol>
<p><img alt="Cost Optimization Step 4" src="../images/CostOptimizationEventBridge2.png" /></p>
<ol>
<li>For Target select "StartAutomationExecution" and type in the document name from step 2</li>
</ol>
<p><img alt="Cost Optimization Step 5" src="../images/CostOptimizationEventBridge3.png" /></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["tabs"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.60a45f97.min.js"></script>
      
    
  </body>
</html>